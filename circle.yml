dependencies:
  override:
    - sudo add-apt-repository -y ppa:ubuntugis
    - sudo apt-get update -y
    - sudo apt-get install -y libgeos-c1v5
    - sudo apt-get install -y libgdal20
    - sudo apt-get install -y gdal-bin libgdal-dev python3-numpy python-numpy
    - pip install tox tox-pyenv
    - pyenv local 2.7.12 3.5.2
    - nvm use v6
    - npm install --prefix js
    - npm run build --prefix js

test:
  pre:
    - mkdir -p $CIRCLE_TEST_REPORTS/pytest/
    - mkdir -p $CIRCLE_ARTIFACTS/coverage
  override:
    - tox --result-json $CIRCLE_ARTIFACTS/tox-result.json -- --cov-report html:$CIRCLE_ARTIFACTS/coverage --junitxml=$CIRCLE_TEST_REPORTS/pytest/JUnit.xml
    - npm run lint --prefix js
